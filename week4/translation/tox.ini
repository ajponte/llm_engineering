[tox]
skipsdist = true
envlist = py311, py311, py313, pylint, pytest, mypy, format, sdist, publish


[testenv:pylint]
allowlist_externals =
    poetry
commands = poetry run pylint --rcfile=.pylintrc translate
deps =
    pylint


[testenv:mypy]
commands =
    mypy gateway --config-file=.mypy.ini --follow-imports=skip
deps =
    mypy
    types-requests
    types-python-dateutil
    types-pytz


; Run black formatting tool
[testenv:format]
allowlist_externals =
    poetry
commands =
    poetry run black --diff --check --config=.pep8 translate
deps =
    black


[testenv:pytest]
;allowlist_externals =
;    poetry
;    werkzeug
;    pytest
;setenv =
;    PYTHONPATH = './geotab_sync/tests/
deps =
    poetry
    pytest
    werkzeug
    connexion
    flask
    boto3
    moto
    python-json-logger
commands =
    poetry run pytest -v tests


[testenv:sdist]
allowlist_externals =
    bash
    mkdir
    poetry
commands =
    # remove old dists, if any
    mkdir -p dist
    bash -c "rm -f dist/*.tar.gz"
    # Build the tarball and wheel
    poetry build


[testenv:publish]
# todo
;allowlist_externals = poetry
;commands =
;    poetry install -v
;    poetry run pytest